!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).vkMiniAppsAPI={})}(this,function(e){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};var i=function(){return(i=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};function c(i,s,u,c){return new(u=u||Promise)(function(e,n){function t(e){try{r(c.next(e))}catch(e){n(e)}}function o(e){try{r(c.throw(e))}catch(e){n(e)}}function r(n){n.done?e(n.value):new u(function(e){e(n.value)}).then(t,o)}r((c=c.apply(i,s||[])).next())})}function a(t,o){var r,i,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){u.label=n[1];break}if(6===n[0]&&u.label<s[1]){u.label=s[1],s=n;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(n);break}s[2]&&u.ops.pop(),u.trys.pop();continue}n=o.call(t,u)}catch(e){n=[6,e],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}}var s=function(){return(s=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var r in n=arguments[t])Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}).apply(this,arguments)};function u(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(t[o[r]]=e[o[r]])}return t}var n=["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppResizeWindow","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites"],p=[],d=null,o="undefined"!=typeof window,r=o&&window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.VKWebAppClose,f=o?window.AndroidBridge:void 0,l=r?window.webkit.messageHandlers:void 0,h=o&&!f&&!l,b=h?"message":"VKWebAppEvent";function v(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),o}o&&(window.CustomEvent||(window.CustomEvent=(v.prototype=Event.prototype,v)),window.addEventListener(b,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=function(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var o=Array(e),r=0;for(n=0;n<t;n++)for(var i=arguments[n],s=0,u=i.length;s<u;s++,r++)o[r]=i[s];return o}(p);if(h&&n[0]&&"data"in n[0]){var o=n[0].data,r=(o.webFrameId,o.connectVersion,u(o,["webFrameId","connectVersion"]));r.type&&"VKWebAppSettings"===r.type?d=r.frameId:t.forEach(function(e){e({detail:r})})}else t.forEach(function(e){e.apply(null,n)})}));function m(e,n){void 0===n&&(n={}),f&&"function"==typeof f[e]&&f[e](JSON.stringify(n)),l&&l[e]&&"function"==typeof l[e].postMessage&&l[e].postMessage(n),h&&parent.postMessage({handler:e,params:n,type:"vk-connect",webFrameId:d,connectVersion:"1.6.5"},"*")}function A(e){p.push(e)}var y,w,V,W={send:m,subscribe:A,sendPromise:(y=m,w=A,V=function(){var t={current:0,next:function(){return this.current+=1,this.current}},r={};return{add:function(e){var n=t.next();return r[n]=e,n},resolve:function(e,n,t){var o=r[e];o&&(t(n)?o.resolve(n):o.reject(n),r[e]=null)}}}(),w(function(e){if(e.detail&&e.detail.data){var n=e.detail.data,t=n.request_id,o=u(n,["request_id"]);t&&V.resolve(t,o,function(e){return!("error_type"in e)})}}),function(o,r){return new Promise(function(e,n){var t=V.add({resolve:e,reject:n});y(o,s(s({},r),{request_id:t}))})}),unsubscribe:function(e){var n=p.indexOf(e);-1<n&&p.splice(n,1)},isWebView:function(){return!(!f&&!l)},supports:function(e){return!(!f||"function"!=typeof f[e])||(!(!l||!l[e]||"function"!=typeof l[e].postMessage)||!(l||f||!n.includes(e)))}};if("object"!=typeof e||"undefined"==typeof module){var K=null;"undefined"!=typeof window?K=window:"undefined"!=typeof global?K=global:"undefined"!=typeof self&&(K=self),K&&(K.vkConnect=W,K.vkuiConnect=W)}var g=(P.prototype.subscribeEvent=function(n,t){function e(e){e.detail&&e.detail.data&&0===e.detail.type.indexOf(n)&&!e.detail.type.includes("Failed")&&t(e.detail.data)}var o=this;return this.connect.subscribe(e),function(){return o.connect.unsubscribe(e)}},P);function P(e){this.connect=e||W}function _(e){return e.map(function(e){return"string"==typeof e?e:e.type+e.ownerId+"_"+e.mediaId}).join(",")}var C,k,S,O=(t(C=G,k=S=g),void(C.prototype=null===k?Object.create(k):(x.prototype=k.prototype,new x)),G.prototype.initApp=function(){this.connect.send("VKWebAppInit",{})},G);function x(){this.constructor=C}function G(){var u=null!==S&&S.apply(this,arguments)||this;return u.onUpdateConfig=function(e){return u.subscribeEvent("VKWebAppUpdateConfig",e)},u.onViewHide=function(e){return u.subscribeEvent("VKWebAppViewHide",e)},u.onViewRestore=function(e){return u.subscribeEvent("VKWebAppViewRestore",e)},u.denyNotifications=function(){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppDenyNotifications")];case 1:return e.sent(),[2]}})})},u.callAPIMethod=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppCallAPIMethod",{method:n,params:t})];case 1:return[2,e.sent().response]}})})},u.closeApp=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppClose",{status:n,payload:t})];case 1:return e.sent(),[2]}})})},u.getAuthToken=function(o,r){return c(u,void 0,void 0,function(){var n,t;return a(this,function(e){switch(e.label){case 0:return n=Array.isArray(r)?r.join(","):"",[4,this.connect.sendPromise("VKWebAppGetAuthToken",{app_id:o,scope:n})];case 1:return[2,{accessToken:(t=e.sent()).access_token,scope:t.scope.split(",")}]}})})},u.getClientVersion=function(){return c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetClientVersion")]})})},u.openApp=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenApp",{app_id:n,location:t})];case 1:return e.sent(),[2]}})})},u.getEmail=function(){return c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetEmail")]})})},u.getFriends=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetFriends",{multi:n})];case 1:return[2,e.sent().users]}})})},u.getGeodata=function(){return c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetGeodata")];case 1:return[2,{isAvailable:!!(n=e.sent()).available,lat:parseFloat(n.lat),long:parseFloat(n.long)}]}})})},u.getPersonalCard=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetPersonalCard",{type:n})]})})},u.getPhoneNumber=function(){return c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetPhoneNumber")];case 1:return[2,{phone:(n=e.sent()).phone_number,sign:n.sign}]}})})},u.getUserInfo=function(){return c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetUserInfo")]})})},u.openCodeReader=function(){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenCodeReader")];case 1:return[2,e.sent().code_data]}})})},u.openContacts=function(){return c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenContacts")];case 1:return[2,{phone:(n=e.sent()).phone,firstName:n.first_name,lastName:n.last_name}]}})})},u.shareLink=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShare",{link:n})];case 1:return[2,e.sent()]}})})},u.showImages=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowImages",{images:n,start_index:t})];case 1:return e.sent(),[2]}})})},u.addToFavorites=function(){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToFavorites")];case 1:return e.sent(),[2]}})})},u.postToWall=function(t,o,r){return c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return n=i({message:t,attachments:Array.isArray(o)?_(o):o},r&&{owner_id:r.ownerId,signed:r.isSigned,place_id:r.placeId,lat:r.lat,long:r.long}),[4,this.connect.sendPromise("VKWebAppShowWallPostBox",n)];case 1:return[2,e.sent().post_id]}})})},u.showMessageBox=function(n,t,o,r,i){return c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppShowMessageBox",{peer_id:n,message:t,attachment:Array.isArray(o)?_(o):o,lat:r,lng:i})]})})},u.addAppToCommunity=function(){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToCommunity")];case 1:return[2,e.sent().group_id]}})})},u.allowCommunityMessages=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowMessagesFromGroup",{group_id:n,key:t})];case 1:return e.sent(),[2]}})})},u.allowCommunityNotifications=function(){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowNotifications")];case 1:return e.sent(),[2]}})})},u.getCommunityToken=function(r,i,s){return c(u,void 0,void 0,function(){var n,t,o=this;return a(this,function(e){switch(e.label){case 0:if(n=Array.isArray(s)?s.join(","):"",null==(t=["VKWebAppCommunityAccessToken","VKWebAppCommunityToken","VKWebAppGetCommunityAuthToken","VKWebAppGetCommunityToken"].filter(function(e){return o.connect.supports(e)})[0]))throw new Error("Couldn't find available method to get community token");return[4,this.connect.sendPromise(t,{app_id:i,group_id:r,scope:n})];case 1:return[2,{accessToken:e.sent().access_token}]}})})},u.joinCommunity=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppJoinGroup",{group_id:n})];case 1:return e.sent(),[2]}})})},u.sendPayloadToCommunity=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSendPayload",{group_id:n,payload:t})];case 1:return e.sent(),[2]}})})},u.showCommunityWidgetPreviewBox=function(n,t,o){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowCommunityWidgetPreviewBox",{type:t,group_id:n,code:o})];case 1:return e.sent(),[2]}})})},u.resizeWindow=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppResizeWindow",{width:n,height:t})]})})},u.scrollTo=function(n,t){return void 0===t&&(t=0),c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppScroll",{top:n,speed:t})]})})},u.setLocationHash=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetLocation",{location:n})];case 1:return e.sent(),[2]}})})},u.setViewSettings=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetViewSettings",{status_bar_style:n,action_bar_color:t})];case 1:return e.sent(),[2]}})})},u.onInitAds=function(e){return u.subscribeEvent("VKWebAppInitAds",e)},u.onLoadAds=function(e){return u.subscribeEvent("VKWebAppLoadAds",e)},u.payToUser=function(t,o,r,i){return c(u,void 0,void 0,function(){var n;return a(this,function(e){return n={action:"pay-to-user",app_id:r,params:{amount:t,user_id:o,description:i}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},u.payToCommunity=function(t,o,r,i,s){return c(u,void 0,void 0,function(){var n;return a(this,function(e){return n={action:"pay-to-group",app_id:r,params:{amount:t,group_id:o,description:i,data:s}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},u.transferToUser=function(t,o){return c(u,void 0,void 0,function(){var n;return a(this,function(e){return n={action:"transfer-to-user",app_id:o,params:{user_id:t}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},u.transferToCommunity=function(t,o){return c(u,void 0,void 0,function(){var n;return a(this,function(e){return n={action:"transfer-to-group",app_id:o,params:{group_id:t}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},u.flashGetInfo=function(){return c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashGetInfo",{})];case 1:return[2,{isAvailable:(n=e.sent()).is_available,level:n.level}]}})})},u.flashSetLevel=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashSetLevel",{level:n})];case 1:return e.sent(),[2]}})})},u.onAudioPaused=function(e){return u.subscribeEvent("VKWebAppAudioPaused",e)},u.onAudioStopped=function(e){return u.subscribeEvent("VKWebAppAudioStopped",e)},u.onAudioTrackChanged=function(e){return u.subscribeEvent("VKWebAppAudioTrackChanged",e)},u.onAudioUnpaused=function(e){return u.subscribeEvent("VKWebAppAudioUnpaused",e)},u.showInviteBox=function(){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowInviteBox")];case 1:return e.sent(),[2]}})})},u.showLeaderBoardBox=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowLeaderBoardBox",{user_result:n})];case 1:return e.sent(),[2]}})})},u.showOrderBox=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowOrderBox",{type:"item",item:n})];case 1:return[2,e.sent().status]}})})},u.showRequestBox=function(n,t,o){return c(u,void 0,void 0,function(){return a(this,function(e){return[2,this.connect.sendPromise("VKWebAppShowRequestBox",{uid:n,message:t,requestKey:o})]})})},u.storageGet=function(t){return c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:[t]})];case 1:return(n=e.sent())&&Array.isArray(n.keys)&&0!==n.keys.length?[2,n.keys[0].value]:[2,""]}})})},u.storageGetMultiple=function(t){return c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:t})];case 1:return[2,(n=e.sent())&&Array.isArray(n.keys)&&0<n.keys.length?n.keys.reduce(function(e,n){var t;return i(i({},e),((t={})[n.key]=n.value,t))},{}):{}]}})})},u.storageGetKeys=function(t,o){return void 0===o&&(o=0),c(u,void 0,void 0,function(){var n;return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGetKeys",{count:t,offset:o})];case 1:return[2,(n=e.sent())&&n.keys||[]]}})})},u.storageSet=function(n,t){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageSet",{key:n,value:t})];case 1:return e.sent(),[2]}})})},u.impactOccurred=function(n){return void 0===n&&(n="medium"),c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticImpactOccurred",{style:n})];case 1:return e.sent(),[2]}})})},u.notificationOccurred=function(n){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticNotificationOccurred",{type:n})];case 1:return e.sent(),[2]}})})},u.selectionChanged=function(){return c(u,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticSelectionChanged")];case 1:return e.sent(),[2]}})})},u}e.VKMiniAppAPI=O,Object.defineProperty(e,"__esModule",{value:!0})});
