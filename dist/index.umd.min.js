!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).vkMiniAppsAPI={})}(this,function(e){"use strict";var o=function(){return(o=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function s(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)n.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(t[r[i]]=e[r[i]])}return t}var n=["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppResizeWindow","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites"],c=[],u=null,t="undefined"!=typeof window,r=t&&window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.VKWebAppClose,i=t?window.AndroidBridge:void 0,a=r?window.webkit.messageHandlers:void 0,p=t&&!i&&!a,d=p?"message":"VKWebAppEvent";function l(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),r}t&&(window.CustomEvent||(window.CustomEvent=(l.prototype=Event.prototype,l)),window.addEventListener(d,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=function(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var r=Array(e),i=0;for(n=0;n<t;n++)for(var o=arguments[n],s=0,c=o.length;s<c;s++,i++)r[i]=o[s];return r}(c);if(p&&n[0]&&"data"in n[0]){var r=n[0].data,i=(r.webFrameId,r.connectVersion,s(r,["webFrameId","connectVersion"]));i.type&&"VKWebAppSettings"===i.type?u=i.frameId:t.forEach(function(e){e({detail:i})})}else t.forEach(function(e){e.apply(null,n)})}));function f(e,n){void 0===n&&(n={}),i&&"function"==typeof i[e]&&i[e](JSON.stringify(n)),a&&a[e]&&"function"==typeof a[e].postMessage&&a[e].postMessage(n),p&&parent.postMessage({handler:e,params:n,type:"vk-connect",webFrameId:u,connectVersion:"1.6.5"},"*")}function h(e){c.push(e)}var v,b,m,w={send:f,subscribe:h,sendPromise:(v=f,b=h,m=function(){var t={current:0,next:function(){return this.current+=1,this.current}},i={};return{add:function(e){var n=t.next();return i[n]=e,n},resolve:function(e,n,t){var r=i[e];r&&(t(n)?r.resolve(n):r.reject(n),i[e]=null)}}}(),b(function(e){if(e.detail&&e.detail.data){var n=e.detail.data,t=n.request_id,r=s(n,["request_id"]);t&&m.resolve(t,r,function(e){return!("error_type"in e)})}}),function(r,i){return new Promise(function(e,n){var t=m.add({resolve:e,reject:n});v(r,o(o({},i),{request_id:t}))})}),unsubscribe:function(e){var n=c.indexOf(e);-1<n&&c.splice(n,1)},isWebView:function(){return!(!i&&!a)},supports:function(e){return!(!i||"function"!=typeof i[e])||(!(!a||!a[e]||"function"!=typeof a[e].postMessage)||!(a||i||!n.includes(e)))}};if("object"!=typeof e||"undefined"==typeof module){var y=null;"undefined"!=typeof window?y=window:"undefined"!=typeof global?y=global:"undefined"!=typeof self&&(y=self),y&&(y.vkConnect=w,y.vkuiConnect=w)}var A=function(e,n){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};function V(e,n){function t(){this.constructor=e}A(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}var W=function(){return(W=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)};function K(o,s,c,u){return new(c=c||Promise)(function(e,n){function t(e){try{i(u.next(e))}catch(e){n(e)}}function r(e){try{i(u.throw(e))}catch(e){n(e)}}function i(n){n.done?e(n.value):new c(function(e){e(n.value)}).then(t,r)}i((u=u.apply(o,s||[])).next())})}function g(t,r){var i,o,s,e,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=r.call(t,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}}var P=(_.prototype.subscribeEvent=function(n,t){function e(e){e.detail&&e.detail.data&&0===e.detail.type.indexOf(n)&&!e.detail.type.includes("Failed")&&t(e.detail.data)}var r=this;return this.connect.subscribe(e),function(){return r.connect.unsubscribe(e)}},_);function _(e){this.connect=e}function k(e){return e.map(function(e){return"string"==typeof e?e:e.type+e.ownerId+"_"+e.mediaId}).join(",")}var O,S=(V(C,O=P),C.prototype.initApp=function(){this.connect.send("VKWebAppInit",{})},C);function C(){var s=null!==O&&O.apply(this,arguments)||this;return s.onUpdateConfig=function(e){return s.subscribeEvent("VKWebAppUpdateConfig",e)},s.onViewHide=function(e){return s.subscribeEvent("VKWebAppViewHide",e)},s.onViewRestore=function(e){return s.subscribeEvent("VKWebAppViewRestore",e)},s.denyNotifications=function(){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppDenyNotifications")];case 1:return e.sent(),[2]}})})},s.callAPIMethod=function(n,t){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppCallAPIMethod",{method:n,params:t})];case 1:return[2,e.sent().response]}})})},s.closeApp=function(n,t){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppClose",{status:n,payload:t})];case 1:return e.sent(),[2]}})})},s.getAuthToken=function(r,i){return K(s,void 0,void 0,function(){var n,t;return g(this,function(e){switch(e.label){case 0:return n=Array.isArray(i)?i.join(","):"",[4,this.connect.sendPromise("VKWebAppGetAuthToken",{app_id:r,scope:n})];case 1:return[2,{accessToken:(t=e.sent()).access_token,scope:t.scope.split(",")}]}})})},s.getClientVersion=function(){return K(s,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetClientVersion")]})})},s.openApp=function(n,t){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenApp",{app_id:n,location:t})];case 1:return e.sent(),[2]}})})},s.getEmail=function(){return K(s,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetEmail")]})})},s.getFriends=function(n){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetFriends",{multi:n})];case 1:return[2,e.sent().users]}})})},s.getGeodata=function(){return K(s,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetGeodata")];case 1:return[2,{isAvailable:!!(n=e.sent()).available,lat:parseFloat(n.lat),long:parseFloat(n.long)}]}})})},s.getPersonalCard=function(n){return K(s,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetPersonalCard",{type:n})]})})},s.getPhoneNumber=function(){return K(s,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetPhoneNumber")];case 1:return[2,{phone:(n=e.sent()).phone_number,sign:n.sign}]}})})},s.getUserInfo=function(){return K(s,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetUserInfo")]})})},s.openCodeReader=function(){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenCodeReader")];case 1:return[2,e.sent().code_data]}})})},s.openContacts=function(){return K(s,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenContacts")];case 1:return[2,{phone:(n=e.sent()).phone,firstName:n.first_name,lastName:n.last_name}]}})})},s.shareLink=function(n){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShare",{link:n})];case 1:return[2,e.sent()]}})})},s.showImages=function(n,t){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowImages",{images:n,start_index:t})];case 1:return e.sent(),[2]}})})},s.addToFavorites=function(){return K(s,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToFavorites")];case 1:return e.sent(),[2]}})})},s.postToWall=function(t,r,i){return K(s,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return n=W({message:t,attachments:Array.isArray(r)?k(r):r},i&&{owner_id:i.ownerId,signed:i.isSigned,place_id:i.placeId,lat:i.lat,long:i.long}),[4,this.connect.sendPromise("VKWebAppShowWallPostBox",n)];case 1:return[2,e.sent().post_id]}})})},s.showMessageBox=function(n,t,r,i,o){return K(s,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppShowMessageBox",{peer_id:n,message:t,attachment:Array.isArray(r)?k(r):r,lat:i,lng:o})]})})},s}var x,G=(V(I,x=P),I);function I(){var e=null!==x&&x.apply(this,arguments)||this;return e.payToUser=function(t,r,i,o){return K(e,void 0,void 0,function(){var n;return g(this,function(e){return n={action:"pay-to-user",app_id:i,params:{amount:t,user_id:r,description:o}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e.payToCommunity=function(t,r,i,o,s){return K(e,void 0,void 0,function(){var n;return g(this,function(e){return n={action:"pay-to-group",app_id:i,params:{amount:t,group_id:r,description:o,data:s}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e.transferToUser=function(t,r){return K(e,void 0,void 0,function(){var n;return g(this,function(e){return n={action:"transfer-to-user",app_id:r,params:{user_id:t}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e.transferToCommunity=function(t,r){return K(e,void 0,void 0,function(){var n;return g(this,function(e){return n={action:"transfer-to-group",app_id:r,params:{group_id:t}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e}var T,E=(V(B,T=P),B);function B(){var e=null!==T&&T.apply(this,arguments)||this;return e.flashGetInfo=function(){return K(e,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashGetInfo",{})];case 1:return[2,{isAvailable:(n=e.sent()).is_available,level:n.level}]}})})},e.flashSetLevel=function(n){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashSetLevel",{level:n})];case 1:return e.sent(),[2]}})})},e}var F,j=(V(M,F=P),M);function M(){var e=null!==F&&F.apply(this,arguments)||this;return e.showInviteBox=function(){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowInviteBox")];case 1:return e.sent(),[2]}})})},e.showLeaderBoardBox=function(n){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowLeaderBoardBox",{user_result:n})];case 1:return e.sent(),[2]}})})},e.showOrderBox=function(n){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowOrderBox",{type:"item",item:n})];case 1:return[2,e.sent().status]}})})},e.showRequestBox=function(n,t,r){return K(e,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppShowRequestBox",{uid:n,message:t,requestKey:r})]})})},e}var N,L=(V(R,N=P),R);function R(){var e=null!==N&&N.apply(this,arguments)||this;return e.get=function(t){return K(e,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:[t]})];case 1:return(n=e.sent())&&Array.isArray(n.keys)&&0!==n.keys.length?[2,n.keys[0].value]:[2,""]}})})},e.getMultiple=function(t){return K(e,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:t})];case 1:return[2,(n=e.sent())&&Array.isArray(n.keys)&&0<n.keys.length?n.keys.reduce(function(e,n){var t;return W(W({},e),((t={})[n.key]=n.value,t))},{}):{}]}})})},e.getKeys=function(t,r){return void 0===r&&(r=0),K(e,void 0,void 0,function(){var n;return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGetKeys",{count:t,offset:r})];case 1:return[2,(n=e.sent())&&n.keys||[]]}})})},e.set=function(n,t){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageSet",{key:n,value:t})];case 1:return e.sent(),[2]}})})},e}var q,U=(V(H,q=P),H);function H(){var e=null!==q&&q.apply(this,arguments)||this;return e.impactOccurred=function(n){return void 0===n&&(n="medium"),K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticImpactOccurred",{style:n})];case 1:return e.sent(),[2]}})})},e.notificationOccurred=function(n){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticNotificationOccurred",{type:n})];case 1:return e.sent(),[2]}})})},e.selectionChanged=function(){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticSelectionChanged")];case 1:return e.sent(),[2]}})})},e}var z,J=(V(D,z=P),D);function D(){var e=null!==z&&z.apply(this,arguments)||this;return e.addApp=function(){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToCommunity")];case 1:return[2,e.sent().group_id]}})})},e.allowMessages=function(n,t){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowMessagesFromGroup",{group_id:n,key:t})];case 1:return e.sent(),[2]}})})},e.allowNotifications=function(){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowNotifications")];case 1:return e.sent(),[2]}})})},e.getToken=function(i,o,s){return K(e,void 0,void 0,function(){var n,t,r=this;return g(this,function(e){switch(e.label){case 0:if(n=Array.isArray(s)?s.join(","):"",null==(t=["VKWebAppCommunityAccessToken","VKWebAppCommunityToken","VKWebAppGetCommunityAuthToken","VKWebAppGetCommunityToken"].filter(function(e){return r.connect.supports(e)})[0]))throw new Error("Couldn't find available method to get community token");return[4,this.connect.sendPromise(t,{app_id:o,group_id:i,scope:n})];case 1:return[2,{accessToken:e.sent().access_token}]}})})},e.join=function(n){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppJoinGroup",{group_id:n})];case 1:return e.sent(),[2]}})})},e.sendPayload=function(n,t){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSendPayload",{group_id:n,payload:t})];case 1:return e.sent(),[2]}})})},e.showWidgetPreviewBox=function(n,t,r){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowCommunityWidgetPreviewBox",{type:t,group_id:n,code:r})];case 1:return e.sent(),[2]}})})},e}var Q,X=(V(Y,Q=P),Y);function Y(){var e=null!==Q&&Q.apply(this,arguments)||this;return e.resizeWindow=function(n,t){return K(e,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppResizeWindow",{width:n,height:t})]})})},e.scrollTo=function(n,t){return void 0===t&&(t=0),K(e,void 0,void 0,function(){return g(this,function(e){return[2,this.connect.sendPromise("VKWebAppScroll",{top:n,speed:t})]})})},e.setLocationHash=function(n){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetLocation",{location:n})];case 1:return e.sent(),[2]}})})},e.setViewSettings=function(n,t){return K(e,void 0,void 0,function(){return g(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetViewSettings",{status_bar_style:n,action_bar_color:t})];case 1:return e.sent(),[2]}})})},e}var Z,$=(V(ee,Z=P),ee);function ee(){var n=null!==Z&&Z.apply(this,arguments)||this;return n.onInitAds=function(e){return n.subscribeEvent("VKWebAppInitAds",e)},n.onLoadAds=function(e){return n.subscribeEvent("VKWebAppLoadAds",e)},n}var ne=function(e){this.connect=e,this.common=new S(this.connect),this.vkPay=new G(this.connect),this.flashlight=new E(this.connect),this.directGames=new j(this.connect),this.storage=new L(this.connect),this.tapticEngine=new U(this.connect),this.interface=new X(this.connect),this.communities=new J(this.connect),this.ads=new $(this.connect)};e.createVKMiniAppAPI=function(e){void 0===e&&(e={});var n=null==e.customConnect?w:e.customConnect;return new ne(n)},Object.defineProperty(e,"__esModule",{value:!0})});
