!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).vkMiniAppsAPI={})}(this,function(e){"use strict";var n=["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppResizeWindow","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites"],o=[],r=null,t="undefined"!=typeof window,i=t&&window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.VKWebAppClose,s=t?window.AndroidBridge:void 0,c=i?window.webkit.messageHandlers:void 0,u=t&&!s&&!c,a=u?"message":"VKWebAppEvent";function p(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},i=document.createEvent("CustomEvent");return i.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),i}t&&(window.CustomEvent||(window.CustomEvent=(p.prototype=Event.prototype,p)),window.addEventListener(a,function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];var t=[].concat(o);if(u&&n[0]&&"data"in n[0]){var i=function(e,n){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&-1===n.indexOf(i)&&(t[i]=e[i]);return t}(n[0].data,["webFrameId","connectVersion"]);i.type&&"VKWebAppSettings"===i.type?r=i.frameId:t.forEach(function(e){e({detail:i})})}else t.forEach(function(e){e.apply(null,n)})}));function d(e,n){void 0===n&&(n={}),s&&"function"==typeof s[e]&&s[e](JSON.stringify(n)),c&&c[e]&&"function"==typeof c[e].postMessage&&c[e].postMessage(n),u&&parent.postMessage({handler:e,params:n,type:"vk-connect",webFrameId:r,connectVersion:"1.5.6-beta.13-promise"},"*")}function l(e){o.push(e)}var f,h,v,b,m,w={send:d,subscribe:l,sendPromise:(h=d,v={current:0,next:function(){return this.current+=1,this.current}},b={},m={add:function(e){var n=v.next();return b[n]=e,n},resolve:function(e,n,t){var i=b[e];i&&(t(n)?i.resolve(n):i.reject(n),b[e]=null)}},l(function(e){if(e.detail&&e.detail.data){var n=e.detail.data,t=n.request_id,i=function(e,n){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&-1===n.indexOf(i)&&(t[i]=e[i]);return t}(n,["request_id"]);t&&m.resolve(t,i,function(e){return!("error_type"in e)})}}),function(i,o){return new Promise(function(e,n){var t=m.add({resolve:e,reject:n});h(i,Object.assign({},o,{request_id:t}))})}),unsubscribe:function(e){var n=o.indexOf(e);-1<n&&o.splice(n,1)},isWebView:function(){return!(!s&&!c)},supports:function(e){return!(!s||"function"!=typeof s[e])||!(!c||!c[e]||"function"!=typeof c[e].postMessage)||!(c||s||!n.includes(e))}};"object"==typeof e&&"undefined"!=typeof module||((f="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0).vkConnect=w,f.vkuiConnect=w);var A=function(e,n){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};function y(e,n){function t(){this.constructor=e}A(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}var V=function(){return(V=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function W(r,s,c,u){return new(c=c||Promise)(function(e,n){function t(e){try{o(u.next(e))}catch(e){n(e)}}function i(e){try{o(u.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new c(function(e){e(n.value)}).then(t,i)}o((u=u.apply(r,s||[])).next())})}function K(t,i){var o,r,s,e,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=i.call(t,c)}catch(e){n=[6,e],r=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}}var g=(P.prototype.createEventListener=function(t){var i=this;return function(n){function e(e){e.detail&&e.detail.data&&0===e.detail.type.indexOf(t)&&!e.detail.type.includes("Failed")&&n(e.detail.data)}return i.connect.subscribe(e),function(){return i.connect.unsubscribe(e)}}},P);function P(e){this.connect=e}function _(e){return e.map(function(e){return"string"==typeof e?e:e.type+e.ownerId+"_"+e.mediaId}).join(",")}var k,S=(y(C,k=g),C.prototype.initApp=function(){this.connect.send("VKWebAppInit",{})},C);function C(){var e=null!==k&&k.apply(this,arguments)||this;return e.onUpdateConfig=e.createEventListener("VKWebAppUpdateConfig"),e.onViewHide=e.createEventListener("VKWebAppViewHide"),e.onViewRestore=e.createEventListener("VKWebAppViewRestore"),e.denyNotifications=function(){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppDenyNotifications")];case 1:return e.sent(),[2]}})})},e.callAPIMethod=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppCallAPIMethod",{method:n,params:t})];case 1:return[2,e.sent().response]}})})},e.closeApp=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppClose",{status:n,payload:t})];case 1:return e.sent(),[2]}})})},e.getAuthToken=function(i,o){return W(e,void 0,void 0,function(){var n,t;return K(this,function(e){switch(e.label){case 0:return n=Array.isArray(o)?o.join(","):"",[4,this.connect.sendPromise("VKWebAppGetAuthToken",{app_id:i,scope:n})];case 1:return[2,{accessToken:(t=e.sent()).access_token,scope:t.scope.split(",")}]}})})},e.getClientVersion=function(){return W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetClientVersion")]})})},e.openApp=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenApp",{app_id:n,location:t})];case 1:return e.sent(),[2]}})})},e.getEmail=function(){return W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetEmail").then(function(e){return e.email})]})})},e.getFriends=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetFriends",{multi:n})];case 1:return[2,e.sent().users]}})})},e.getGeodata=function(){return W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetGeodata")];case 1:return[2,{isAvailable:!!(n=e.sent()).available,lat:parseFloat(n.lat),long:parseFloat(n.long)}]}})})},e.getPersonalCard=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetPersonalCard",{type:n})]})})},e.getPhoneNumber=function(){return W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetPhoneNumber")];case 1:return[2,{phone:(n=e.sent()).phone_number,sign:n.sign}]}})})},e.getUserInfo=function(){return W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetUserInfo")]})})},e.openCodeReader=function(){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenCodeReader")];case 1:return[2,e.sent().code_data]}})})},e.openContacts=function(){return W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenContacts")];case 1:return[2,{phone:(n=e.sent()).phone,firstName:n.first_name,lastName:n.last_name}]}})})},e.shareLink=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShare",{link:n})];case 1:return[2,e.sent()]}})})},e.showImages=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowImages",{images:n,start_index:t})];case 1:return e.sent(),[2]}})})},e.addToFavorites=function(){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToFavorites")];case 1:return e.sent(),[2]}})})},e.postToWall=function(t,i,o){return W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return n=V({message:t,attachments:Array.isArray(i)?_(i):i},o&&{owner_id:o.ownerId,signed:o.isSigned,place_id:o.placeId,lat:o.lat,long:o.long}),[4,this.connect.sendPromise("VKWebAppShowWallPostBox",n)];case 1:return[2,e.sent().post_id]}})})},e.showMessageBox=function(n,t,i,o,r){return W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppShowMessageBox",{peer_id:n,message:t,attachment:Array.isArray(i)?_(i):i,lat:o,lng:r})]})})},e}var O,x=(y(G,O=g),G);function G(){var e=null!==O&&O.apply(this,arguments)||this;return e.payToUser=function(t,i,o,r){return W(e,void 0,void 0,function(){var n;return K(this,function(e){return n={action:"pay-to-user",app_id:o,params:{amount:t,user_id:i,description:r}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e.payToCommunity=function(t,i,o,r,s){return W(e,void 0,void 0,function(){var n;return K(this,function(e){return n={action:"pay-to-group",app_id:o,params:{amount:t,group_id:i,description:r,data:s}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e.transferToUser=function(t,i){return W(e,void 0,void 0,function(){var n;return K(this,function(e){return n={action:"transfer-to-user",app_id:i,params:{user_id:t}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e.transferToCommunity=function(t,i){return W(e,void 0,void 0,function(){var n;return K(this,function(e){return n={action:"transfer-to-group",app_id:i,params:{group_id:t}},[2,this.connect.sendPromise("VKWebAppOpenPayForm",n)]})})},e}var I,T=(y(B,I=g),B);function B(){var e=null!==I&&I.apply(this,arguments)||this;return e.flashGetInfo=function(){return W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashGetInfo",{})];case 1:return[2,{isAvailable:(n=e.sent()).is_available,level:n.level}]}})})},e.flashSetLevel=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashSetLevel",{level:n})];case 1:return e.sent(),[2]}})})},e}var E,F=(y(L,E=g),L);function L(){var e=null!==E&&E.apply(this,arguments)||this;return e.showInviteBox=function(){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowInviteBox")];case 1:return e.sent(),[2]}})})},e.showLeaderBoardBox=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowLeaderBoardBox",{user_result:n})];case 1:return e.sent(),[2]}})})},e.showOrderBox=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowOrderBox",{type:"item",item:n})];case 1:return[2,e.sent().status]}})})},e.showRequestBox=function(n,t,i){return W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppShowRequestBox",{uid:n,message:t,requestKey:i})]})})},e}var j,M=(y(N,j=g),N);function N(){var e=null!==j&&j.apply(this,arguments)||this;return e.get=function(t,i){return void 0===i&&(i=!1),W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:[t],global:i})];case 1:return(n=e.sent())&&Array.isArray(n.keys)&&0!==n.keys.length?[2,n.keys[0].value]:[2,null]}})})},e.getMultiple=function(t,i){return void 0===i&&(i=!1),W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:t,global:i})];case 1:return[2,(n=e.sent())&&Array.isArray(n.keys)&&0<n.keys.length?n.keys.reduce(function(e,n){var t;return V(V({},e),((t={})[n.key]=n.value,t))},{}):{}]}})})},e.getKeys=function(t,i,o){return void 0===i&&(i=0),void 0===o&&(o=!1),W(e,void 0,void 0,function(){var n;return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGetKeys",{count:t,offset:i,global:o})];case 1:return[2,(n=e.sent())&&n.keys||[]]}})})},e.set=function(n,t,i){return void 0===i&&(i=!1),W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageSet",{key:n,value:t,global:i})];case 1:return e.sent(),[2]}})})},e}var R,q=(y(U,R=g),U);function U(){var e=null!==R&&R.apply(this,arguments)||this;return e.impactOccurred=function(n){return void 0===n&&(n="medium"),W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticImpactOccurred",{style:n})];case 1:return e.sent(),[2]}})})},e.notificationOccurred=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticNotificationOccurred",{type:n})];case 1:return e.sent(),[2]}})})},e.selectionChanged=function(){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticSelectionChanged")];case 1:return e.sent(),[2]}})})},e}var H,z=(y(J,H=g),J);function J(){var e=null!==H&&H.apply(this,arguments)||this;return e.addApp=function(){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToCommunity")];case 1:return[2,e.sent().group_id]}})})},e.allowMessages=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowMessagesFromGroup",{group_id:n,key:t})];case 1:return e.sent(),[2]}})})},e.allowNotifications=function(){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowNotifications")];case 1:return e.sent(),[2]}})})},e.getToken=function(o,r,s){return W(e,void 0,void 0,function(){var n,t,i=this;return K(this,function(e){switch(e.label){case 0:if(n=Array.isArray(s)?s.join(","):"",null==(t=["VKWebAppCommunityAccessToken","VKWebAppCommunityToken","VKWebAppGetCommunityAuthToken","VKWebAppGetCommunityToken"].filter(function(e){return i.connect.supports(e)})[0]))throw new Error("Couldn't find available method to get community token");return[4,this.connect.sendPromise(t,{app_id:r,group_id:o,scope:n})];case 1:return[2,{accessToken:e.sent().access_token}]}})})},e.join=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppJoinGroup",{group_id:n})];case 1:return e.sent(),[2]}})})},e.sendPayload=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSendPayload",{group_id:n,payload:t})];case 1:return e.sent(),[2]}})})},e.showWidgetPreviewBox=function(n,t,i){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowCommunityWidgetPreviewBox",{type:t,group_id:n,code:i})];case 1:return e.sent(),[2]}})})},e}var D,Q=(y(X,D=g),X);function X(){var e=null!==D&&D.apply(this,arguments)||this;return e.resizeWindow=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppResizeWindow",{width:n,height:t})]})})},e.scrollTo=function(n,t){return void 0===t&&(t=0),W(e,void 0,void 0,function(){return K(this,function(e){return[2,this.connect.sendPromise("VKWebAppScroll",{top:n,speed:t})]})})},e.setLocationHash=function(n){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetLocation",{location:n})];case 1:return e.sent(),[2]}})})},e.setViewSettings=function(n,t){return W(e,void 0,void 0,function(){return K(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetViewSettings",{status_bar_style:n,action_bar_color:t})];case 1:return e.sent(),[2]}})})},e}var Y,Z=(y($,Y=g),$);function $(){var e=null!==Y&&Y.apply(this,arguments)||this;return e.onInitAds=e.createEventListener("VKWebAppInitAds"),e.onLoadAds=e.createEventListener("VKWebAppLoadAds"),e}var ee=function(e){this.connect=e,this.common=new S(this.connect),this.vkPay=new x(this.connect),this.flashlight=new T(this.connect),this.directGames=new F(this.connect),this.storage=new M(this.connect),this.tapticEngine=new q(this.connect),this.interface=new Q(this.connect),this.communities=new z(this.connect),this.ads=new Z(this.connect)};e.createVKMiniAppAPI=function(e){var n=null==e.customConnect?w:e.customConnect;return new ee(n)},Object.defineProperty(e,"__esModule",{value:!0})});
